"0","str_clean <- function(x, new_stop = NULL){"
"0","  "
"0","  sw <- tm::stopwords(""eng"")"
"0","  if(!is.null(new_stop)) sw <- append(sw, new_stop)"
"0","  "
"0","  library(dplyr)"
"0","  text_dat <- data.frame(id = 1:length(x), ctext = x, stringsAsFactors = F) %>%"
"0","    mutate(block = ntile(ctext, 20))"
"0","  "
"0","  stopwords <- function(x) {"
"0","    x %>%"
"0","      tidytext::unnest_tokens(word, ctext) %>%"
"0","      anti_join(data.frame(word = sw)) %>%"
"0","      group_by(id) %>%"
"0","      summarise(comment = paste(word, collapse = "" "")) %>%"
"0","      mutate(comment = "
"0","        comment %>% "
"0","          stringr::str_replace_all("" ?(f|ht)tp(s?)://(.*)[.][a-z]+"", """") %>%"
"0","          textstem::lemmatize_strings() %>%"
"0","          stringr::str_replace_all(""\\'"", """") %>%"
"0","          stringr::str_replace_all(""[^a-zA-Zäüöß\\s]"", "" "") %>%"
"0","          stringr::str_to_lower() %>% "
"0","          stringr::str_trim()"
"0","      )"
"0","    cat(""block:"", x$block[1], ""\n"")"
"0","  }"
"0","  "
"0","  # cvector <- list()"
"0","  # for (jj in seq_along(unique(text_dat$block))) {"
"0","  #   cvector[[jj]] <- stopwords(x = text_dat[text_dat$block == jj,]) "
"0","  #   cat(jj, ""\n"")"
"0","  # }"
"0","  "
"0","  text_dat %>%"
"0","    split(.$block) %>% # from base R"
"0","    map(~ stopwords(x =.)) %>%"
"0","    bind_rows()"
"0","  "
"0","  cat(""... FINISHED ..."")"
"0","  return(text_dat)"
"0","}"
